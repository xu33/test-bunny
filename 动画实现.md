è¿™æ˜¯ä¸€ä¸ªéå¸¸æ·±å…¥ä¸”å…·æœ‰æŒ‘æˆ˜æ€§çš„é—®é¢˜ã€‚åœ¨è§†é¢‘ç¼–è¾‘ä¸­ï¼Œ**åŠ¨ç”»å±æ€§ï¼ˆAnimation Propertiesï¼‰** æ˜¯å®ç°åŠ¨æ€å›¾å½¢ã€è¿åŠ¨è·¯å¾„ã€å…³é”®å¸§ï¼ˆKeyframesï¼‰çš„æ ¸å¿ƒã€‚

å¯¹äºå›¾ç‰‡ã€æ–‡æœ¬æˆ– Canvas åŠ¨ç”»è¿™ç±»å…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¹‹å‰å®šä¹‰çš„**é™æ€å˜æ¢å±æ€§**æ‰©å±•ä¸ºæ”¯æŒ**éšæ—¶é—´å˜åŒ–çš„å±æ€§**ã€‚

## ğŸ¬ åŠ¨ç”»æ•°æ®ç»“æ„è®¾è®¡ï¼šå…³é”®å¸§ç³»ç»Ÿ (Keyframe System)

æœ€æˆç†Ÿå’Œçµæ´»çš„è®¾è®¡æ¨¡å¼æ˜¯ **åŸºäºå…³é”®å¸§** çš„æ–¹æ³•ã€‚å®ƒå°†ä¸€ä¸ªå±æ€§ï¼ˆå¦‚ä½ç½® $X$ã€æ—‹è½¬ $R$ã€ç¼©æ”¾ $S$ï¼‰çš„å€¼ä¸å…¶åœ¨æ—¶é—´è½´ä¸Šçš„ç‰¹å®šæ—¶é—´ç‚¹å…³è”èµ·æ¥ã€‚

### 1\. åŸºç¡€æ•°æ®ç»“æ„å‡çº§ (AnimatableElement)

æˆ‘ä»¬å°†ä¹‹å‰é€šç”¨çš„ `BaseElement` å‡çº§ä¸º `AnimatableElement`ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å°†æ‰€æœ‰éœ€è¦åŠ¨ç”»çš„**é™æ€å±æ€§**è½¬æ¢ä¸ºä¸€ä¸ª **å…³é”®å¸§é›†åˆ**ã€‚

```typescript
// --- æ ¸å¿ƒåŠ¨ç”»æ•°æ®ç»“æ„ ---

/**
 * KeyframeValue å®šä¹‰äº†å±æ€§åœ¨ç‰¹å®šæ—¶é—´ç‚¹çš„å€¼å’Œæ’å€¼æ–¹å¼
 */
interface KeyframeValue<T> {
    time: number; // å…³é”®å¸§åœ¨å…ƒç´ æ—¶é—´è½´ä¸Šçš„ç›¸å¯¹æ—¶é—´ (ms)ï¼Œè€Œéç»å¯¹æ—¶é—´
    value: T;     // å±æ€§åœ¨æ­¤æ—¶åˆ»çš„å€¼
    // æ’å€¼æ–¹å¼ (Interpolation Type)ï¼šå†³å®šå€¼å¦‚ä½•ä»å‰ä¸€ä¸ªå…³é”®å¸§è¿‡æ¸¡åˆ°å½“å‰å…³é”®å¸§
    // 'linear': çº¿æ€§è¿‡æ¸¡ (åŒ€é€Ÿ)
    // 'ease-in-out': ç¼“å…¥ç¼“å‡º (å¹³æ»‘è¿‡æ¸¡)
    // 'hold': ä¿æŒå€¼ä¸å˜ç›´åˆ°ä¸‹ä¸€ä¸ªå…³é”®å¸§
    interpolation: 'linear' | 'ease-in-out' | 'hold' | 'custom-bezier'; 
}

/**
 * AnimatedProperty å®šä¹‰äº†æŸä¸ªåŠ¨ç”»å±æ€§çš„å®Œæ•´å…³é”®å¸§åºåˆ—
 */
interface AnimatedProperty<T> {
    keyframes: KeyframeValue<T>[];
}

// --- åŠ¨ç”»å…ƒç´ çš„ç»“æ„ ---

interface AnimatableElement {
    // ... åŸºç¡€å±æ€§ (id, type, sourceUrl, zIndex, timelineStart/End)

    // é™æ€å±æ€§ï¼šä¸å†æ”¯æŒåŠ¨ç”»çš„å±æ€§ï¼Œå¦‚ content, fontColor
    content: string; 
    
    // åŠ¨æ€å±æ€§ï¼šæ‰€æœ‰å¯éšæ—¶é—´å˜åŒ–çš„å±æ€§éƒ½è¢«åŒ…è£…åœ¨ AnimatedProperty ä¸­
    positionX: AnimatedProperty<number>;
    positionY: AnimatedProperty<number>;
    scaleX: AnimatedProperty<number>;
    scaleY: AnimatedProperty<number>;
    rotation: AnimatedProperty<number>;
    opacity: AnimatedProperty<number>;
    
    // é¢œè‰²ã€æ»¤é•œç­‰ä¹Ÿå¯ä»¥è¢«åŠ¨ç”»
    colorTint?: AnimatedProperty<string>;
    blurAmount?: AnimatedProperty<number>;
}
```

### 2\. å¦‚ä½•è®¡ç®—å½“å‰å€¼ (Value Interpolation)

åœ¨ä½ çš„ **æ¸²æŸ“å¾ªç¯** ä¸­ï¼Œä½ éœ€è¦ä¸€ä¸ªä¸“é—¨çš„å‡½æ•°æ¥è®¡ç®—åœ¨ç»™å®šæ—¶é—´ç‚¹ $T$ æ—¶ï¼ŒæŸä¸ªåŠ¨ç”»å±æ€§çš„å®é™…å€¼ã€‚

**è®¡ç®—é€»è¾‘ (`getAnimatedValue`):**

å‡è®¾æˆ‘ä»¬éœ€è¦è®¡ç®—å…ƒç´  $E$ åœ¨å½“å‰**å…ƒç´ ç›¸å¯¹æ—¶é—´** $T_{\text{relative}}$ ä¸‹çš„ $X$ ä½ç½®ã€‚

1.  **æŸ¥æ‰¾å…³é”®å¸§ï¼š** éå† `E.positionX.keyframes` æ•°ç»„ã€‚
      * æ‰¾åˆ°æœ€æ¥è¿‘ä¸”**å°äºæˆ–ç­‰äº** $T_{\text{relative}}$ çš„å…³é”®å¸§ï¼ˆ$K_{\text{start}}$ï¼‰ã€‚
      * æ‰¾åˆ°æœ€æ¥è¿‘ä¸”**å¤§äº** $T_{\text{relative}}$ çš„å…³é”®å¸§ï¼ˆ$K_{\text{end}}$ï¼‰ã€‚
2.  **è¾¹ç•Œå¤„ç†ï¼š**
      * å¦‚æœ $T_{\text{relative}} \le K_{\text{start}}$ çš„æ—¶é—´ï¼Œåˆ™è¿”å› $K_{\text{start}}$ çš„å€¼ã€‚
      * å¦‚æœ $T_{\text{relative}} \ge K_{\text{end}}$ çš„æ—¶é—´ï¼Œåˆ™è¿”å› $K_{\text{end}}$ çš„å€¼ã€‚
3.  **æ’å€¼è®¡ç®—ï¼š** å¦‚æœ $T_{\text{relative}}$ ä»‹äºä¸¤è€…ä¹‹é—´ï¼Œæ ¹æ® $K_{\text{start}}$ çš„ `interpolation` ç±»å‹è¿›è¡Œè®¡ç®—ï¼š
      * **çº¿æ€§ (Linear):** è¿™æ˜¯æœ€ç®€å•çš„æ’å€¼ï¼Œç›´æ¥æŒ‰æ—¶é—´æ¯”ä¾‹ $P$ è¿›è¡ŒåŠ æƒå¹³å‡ã€‚
        $$P = \frac{T_{\text{relative}} - K_{\text{start}}.\text{time}}{K_{\text{end}}.\text{time} - K_{\text{start}}.\text{time}}$$
        $$\text{Value} = K_{\text{start}}.\text{value} \times (1-P) + K_{\text{end}}.\text{value} \times P$$
      * **ç¼“åŠ¨ (Ease-in-out):** éœ€è¦ä½¿ç”¨ä¸€ä¸ªç¼“åŠ¨å‡½æ•°ï¼ˆå¦‚ `Cubic Bezier`ï¼‰æ¥ä¿®æ”¹ $P$ çš„å€¼ï¼Œä½¿å…¶åœ¨å¼€å§‹å’Œç»“æŸæ—¶å˜æ…¢ï¼Œä¸­é—´å˜å¿«ï¼Œç„¶åä»£å…¥çº¿æ€§å…¬å¼ã€‚
      * **ä¿æŒ (Hold):** ç›´æ¥è¿”å› $K_{\text{start}}.\text{value}$ã€‚

### 3\. Canvas åŠ¨ç”»å…ƒç´ çš„ç¤ºä¾‹ç»“æ„

ä¸€ä¸ªåŒ…å«åŠ¨ç”»çš„æ–‡æœ¬å…ƒç´ åœ¨ Zustand Store ä¸­çš„æ•°æ®ç»“æ„å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼š

```typescript
const AnimatedTextElement: AnimatableElement = {
    id: 'text-1',
    type: 'text',
    timelineStart: 1000,
    timelineEnd: 6000,
    zIndex: 5,
    content: 'åŠ¨æ€æ ‡é¢˜',
    
    // åŠ¨ç”»å±æ€§å®šä¹‰
    positionX: {
        keyframes: [
            // 0ms: å…ƒç´ åˆšå‡ºç°æ—¶ï¼ŒX ä½äºå·¦ä¾§ -100 (å±å¹•å¤–)
            { time: 0, value: -100, interpolation: 'ease-in-out' }, 
            // 500ms: ç§»å…¥åˆ° X=400 (å±å¹•ä¸­å¤®)
            { time: 500, value: 400, interpolation: 'hold' },         
            // 4000ms: ä¿æŒåœ¨ 400 ä¸åŠ¨ (ä¸Šä¸€ä¸ªå…³é”®å¸§æ˜¯ 'hold')
            { time: 4000, value: 400, interpolation: 'ease-in-out' }, 
            // 4500ms: ç§»å‡ºåˆ° X=900 (å±å¹•å¤–)
            { time: 4500, value: 900, interpolation: 'linear' },      
        ]
    },
    
    // æ—‹è½¬åŠ¨ç”» (é™æ­¢ - æ—‹è½¬ - é™æ­¢)
    rotation: {
        keyframes: [
            { time: 0, value: 0, interpolation: 'hold' },
            { time: 500, value: 0, interpolation: 'linear' },
            { time: 2000, value: Math.PI / 4, interpolation: 'linear' }, // æ—‹è½¬ 45 åº¦
            { time: 4500, value: Math.PI / 4, interpolation: 'hold' },
        ]
    },
    
    // ... positionY, scaleX, opacity ç­‰å…¶ä»–å±æ€§
};
```

### æ€»ç»“

è¿™ç§åŸºäºå…³é”®å¸§çš„æ•°æ®ç»“æ„æ˜¯å¤„ç†å¤æ‚åŠ¨ç”»çš„æ ¸å¿ƒã€‚å®ƒå°† **â€œæŸä¸€æ—¶åˆ»çš„å€¼â€** æŠ½è±¡ä¸º **â€œåœ¨ä¸¤ä¸ªå…³é”®å¸§ä¹‹é—´æ’å€¼è®¡ç®—å‡ºçš„å€¼â€**ã€‚

åœ¨ä½ çš„ **æ¸²æŸ“å¾ªç¯** ä¸­ï¼Œä½ å°†ï¼š

1.  **è°ƒåº¦ï¼š** æ‰¾å‡ºæ´»è·ƒå…ƒç´  $E$ã€‚
2.  **æ—¶é—´æ˜ å°„ï¼š** è®¡ç®— $E$ çš„ **ç›¸å¯¹æ—¶é—´** $T_{\text{relative}} = T - E.\text{timelineStart}$ã€‚
3.  **æ’å€¼ï¼š** å¯¹ $E$ çš„æ¯ä¸ªåŠ¨ç”»å±æ€§ï¼ˆ`positionX`, `rotation` ç­‰ï¼‰è°ƒç”¨ **æ’å€¼å‡½æ•°**ï¼Œè®¡ç®—å‡ºå½“å‰å¸§çš„å®é™…å€¼ã€‚
4.  **ç»˜åˆ¶ï¼š** å°†è®¡ç®—å‡ºçš„å€¼åº”ç”¨åˆ° Fabric.js/PixiJS å¯¹è±¡ä¸Šã€‚

è¿™æ ·ï¼Œä½ å°±æ‹¥æœ‰äº†ä¸€ä¸ªæ—¢èƒ½å¤„ç†é™æ€å˜æ¢ï¼Œåˆèƒ½å¤„ç†å¤æ‚æ—¶é—´åŠ¨ç”»çš„é€šç”¨ä¸”å¯æ‰©å±•çš„æ•°æ®æ¨¡å‹ã€‚